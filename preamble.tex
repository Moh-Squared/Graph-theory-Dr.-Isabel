% =============================================================
% PREAMBLE.TEX - ROBUST TITLE FIX
% =============================================================

\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage{lmodern} 

% --- Emoji Support ---
\usepackage{twemojis} 

% --- Page Layout ---
\usepackage[a4paper, margin=2.5cm, headheight=15pt]{geometry}
\usepackage{fancyhdr}
\usepackage{lastpage}
\usepackage{needspace}
\usepackage{etoolbox} 

% --- Paragraph Styling ---
\usepackage[parfill]{parskip} 

% --- Typographic Penalties ---
\widowpenalty=10000
\clubpenalty=10000

% --- Math & Symbols ---
\usepackage{amsmath, amssymb, amsthm, amsfonts}
\usepackage{mathtools}
\usepackage{stmaryrd} 

% --- Graphics & Colors ---
\usepackage{graphicx}
\usepackage{xcolor}
\usepackage{tikz} 
\usetikzlibrary{positioning, arrows.meta, shapes, calc}

% --- Color Definitions ---
\definecolor{aucred}{RGB}{140, 0, 50}   
\definecolor{aucteal}{RGB}{0, 96, 96}   
\definecolor{aucblue}{RGB}{0, 0, 60}    

% --- Hyperlinks ---
\usepackage[colorlinks=true, linkcolor=aucblue, urlcolor=aucblue, citecolor=aucblue]{hyperref}

% --- CUSTOM HEADER STYLING ---
\usepackage{titlesec}

\pretocmd{\section}{\needspace{9\baselineskip}}{}{}

\renewcommand{\thesection}{\arabic{section}}

\titleformat{\chapter}[display]
  {\normalfont\centering\color{aucblue}}
  {\titlerule[2.5pt]\vspace{2pt}\titlerule[1pt] \vspace{1ex} \huge\scshape\chaptertitlename\ \thechapter}
  {1ex}
  {\titlerule[1pt]\vspace{2pt}\titlerule[2.5pt] \vspace{4ex} \Huge\scshape}
  []

\titleformat{\section}
  {\normalfont\Large\scshape\centering\color{aucblue}} 
  {\thesection.} 
  {0.7em} 
  {}

% --- UNIFIED COUNTER SYSTEM ---
\newcounter{seq}[chapter]
\renewcommand{\theseq}{\thechapter.\arabic{seq}}

\newcommand{\topic}[1]{%
    \par\vspace{0.5cm}\noindent%
    \needspace{3\baselineskip}% 
    \refstepcounter{seq}%
    {\large \underline{\textbf{\theseq~#1}}}%
    \par\vspace{0.2cm}%
}

% --- BOX ENVIRONMENTS ---
\usepackage[most]{tcolorbox}
\tcbuselibrary{breakable, skins}

\tcbset{
    auccommon/.style={
        enhanced jigsaw,      
        breakable,            
        lines before break=4, 
        fonttitle=\bfseries,
        coltitle=white,
        boxrule=0.5pt,        
        arc=2mm,              
        left=2mm, right=2mm, top=2mm, bottom=2mm, 
        toptitle=1.5mm, bottomtitle=1.5mm,
        oversize=0pt,
    }
}

% Note: We use [1] and default empty. 
% Usage: \begin{definition}[Title]
\newtcolorbox{definition}[1][]{%
    auccommon,
    colback=aucred!5!white, 
    colframe=aucred, 
    colbacktitle=aucred,
    title={Definition~\refstepcounter{seq}\theseq\ifstrempty{#1}{}{~#1}}
}

\newtcolorbox{theorem}[1][]{%
    auccommon,
    colback=aucteal!5!white, 
    colframe=aucteal, 
    colbacktitle=aucteal,
    title={Theorem~\refstepcounter{seq}\theseq\ifstrempty{#1}{}{~#1}}
}

\newtcolorbox{lemma}[1][]{%
    auccommon,
    colback=aucteal!5!white, 
    colframe=aucteal, 
    colbacktitle=aucteal,
    title={Lemma~\refstepcounter{seq}\theseq\ifstrempty{#1}{}{~#1}}
}

\newtcolorbox{corollary}[1][]{%
    auccommon,
    colback=aucteal!5!white, 
    colframe=aucteal, 
    colbacktitle=aucteal,
    title={Corollary~\refstepcounter{seq}\theseq\ifstrempty{#1}{}{~#1}}
}

\newenvironment{example}[1][]{%
    \par\vspace{0.5cm}\noindent
    \needspace{3\baselineskip}% 
    \refstepcounter{seq}%
    \textbf{\color{aucblue}Example \theseq.}%
    \ifstrempty{#1}{}{ \textit{#1}}% 
    \hspace{0.5em}% 
    \ignorespaces
}{\par\vspace{0.5cm}}

\newenvironment{remark}[1][]{%
    \par\vspace{0.5cm}\noindent
    \needspace{3\baselineskip}% 
    \refstepcounter{seq}%
    \textbf{\color{aucblue}Remark \theseq.}%
    \ifstrempty{#1}{}{ \textit{#1}}% 
    \hspace{0.5em}% 
    \ignorespaces
}{\par\vspace{0.5cm}}

\let\oldproof\proof
\let\endoldproof\endproof
\renewenvironment{proof}{\oldproof}{\endoldproof}

% --- Graph Macros ---
\newcommand{\V}[1]{V(#1)}
\newcommand{\E}[1]{E(#1)}
\newcommand{\degv}[1]{\text{deg}(#1)}
\newcommand{\deltaG}{\delta(G)}
\newcommand{\DeltaG}{\Delta(G)}